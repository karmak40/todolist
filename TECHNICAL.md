# Техническая документация TODO List приложения

## Архитектура проекта

```
lib/
├── main.dart                           # Точка входа приложения
├── constants/
│   └── app_constants.dart              # Глобальные константы
├── models/
│   ├── task.dart                       # Модель Task
│   └── user.dart                       # Модель User
├── providers/
│   └── task_provider.dart              # Provider для управления задачами
├── screens/
│   ├── home_screen.dart                # Главный экран приложения
│   └── dialog_add_task.dart            # Диалог добавления новой задачи
├── utils/
│   └── date_utils.dart                 # Утилиты для работы с датами
└── widgets/
    ├── task_card.dart                  # Виджет карточки задачи
    ├── user_header.dart                # Виджет заголовка пользователя
    ├── date_info.dart                  # Виджет информации о дате
    ├── tab_switcher.dart               # Виджет переключателя вкладок
    └── week_navigation.dart            # Виджет навигации по дням
```

## Система управления состоянием

Приложение использует встроенный `ChangeNotifier` для управления состоянием:

### TaskProvider
Класс `TaskProvider` управляет всеми задачами:
- Добавление новой задачи
- Удаление задачи
- Обновление задачи
- Переключение статуса выполнения
- Получение задач по датам
- Вычисление процента выполнения

## Основные компоненты

### HomeScreen
Главный экран, содержащий:
- Header с информацией пользователя
- Информацию о дате и прогрессе
- Систему вкладок
- Навигацию по дням
- Список задач

**Состояние (State):**
- `selectedDate` - выбранная дата
- `isTasksTabSelected` - выбрана ли вкладка "Задания"
- `allTasks` - список всех задач
- `user` - информация пользователя

**Методы:**
- `getTasksForSelectedDate()` - получить задачи выбранной даты
- `getCompletionPercentage()` - вычислить процент выполнения на сегодня
- `toggleTaskCompletion()` - переключить статус выполнения задачи
- `addTask()` - добавить новую задачу

### TaskCard
Виджет карточки задачи, отображающий:
- Аватар пользователя
- Название и время задачи
- Чекбокс для отметки выполнения
- Описание задачи

### AddTaskDialog
Диалог для создания новой задачи с полями:
- Название (обязательное)
- Описание (опционально)
- Длительность (по умолчанию 30 минут)
- Дата (по умолчанию сегодня)

### WeekNavigation
Горизонтальный список дней недели с возможностью выбора текущего дня.

## Утилиты (date_utils.dart)

### Функции для работы с датами и временем

```dart
// Приветствие по времени
String getGreeting()

// Полное имя дня недели
String getDayName(int dayOfWeek)

// Короткое имя дня (Пн, Вт и т.д.)
String getShortDayName(int dayOfWeek)

// Форматирование даты
String formatDate(DateTime date)

// Форматирование времени
String formatTime(int minutes)

// Процент выполнения
int calculateCompletionPercentage(List<bool> completedStatuses)

// Проверка, одинаковые ли даты
bool isSameDay(DateTime date1, DateTime date2)

// Получить понедельник текущей недели
DateTime getStartOfWeek()
```

## Жизненный цикл виджетов

### HomeScreen
1. `initState()` - инициализация выбранной даты (сегодня)
2. `build()` - отрисовка всех элементов экрана
3. `setState()` - обновление при изменении выбранной даты или статуса задачи

### AddTaskDialog
1. `initState()` - инициализация контроллеров текстовых полей
2. `dispose()` - очистка контроллеров
3. `_addTask()` - создание новой задачи и закрытие диалога

## Структура данных

### Task
```dart
class Task {
  final String id;           // UUID или временная метка
  final String title;        // Название
  final String description;  // Описание
  final int durationMinutes; // Длительность
  DateTime date;             // Дата выполнения
  bool isCompleted;          // Статус
  final String? userIcon;    // Иконка (опционально)
}
```

### User
```dart
class User {
  final String id;              // Уникальный идентификатор
  final String name;            // Имя
  final String? avatarUrl;      // URL аватара (опционально)
}
```

## Стили и темы

### Цветовая схема
- **Основной цвет:** Colors.blue
- **Фон:** Colors.white
- **Текст:** Colors.black87
- **Серый:** Colors.grey[300] для вспомогательных элементов

### Размеры шрифтов
- Заголовки: 24px (bold)
- Основной текст: 16px
- Вспомогательный текст: 14px
- Мелкий текст: 12px

### Отступы
- Маленький: 8px
- Средний: 16px
- Большой: 24px

## Взаимодействие пользователя

### События
1. **Нажатие на день недели**
   - Изменяет `selectedDate`
   - Обновляет список задач
   - Обновляет информацию о дате и прогрессе

2. **Нажатие на чекбокс**
   - Вызывает `toggleTaskCompletion()`
   - Обновляет статус задачи
   - Пересчитывает процент выполнения

3. **Нажатие на кнопку "+"**
   - Открывает диалог добавления задачи
   - При подтверждении вызывает `addTask()`

4. **Выбор вкладки**
   - Изменяет `isTasksTabSelected`
   - Обновляет отображение контента

## Обработка ошибок

### Валидация
- Название задачи обязательно
- Длительность должна быть положительным числом
- Дата должна быть в будущем или сегодня

### Сообщения об ошибках
Используется `ScaffoldMessenger` для отображения SnackBar с ошибками:
```dart
ScaffoldMessenger.of(context).showSnackBar(
  const SnackBar(content: Text('Сообщение об ошибке'))
);
```

## Производительность

### Оптимизации
- Использование `ValueKey` для идентификации TaskCard
- Кэширование вычисляемых значений (дата недели, приветствие)
- Эффективная прокрутка (ListView.builder вместо ListView)

### Рекомендации
- Ограничить список задач до 100-200 на экране
- Использовать пагинацию для больших наборов данных
- Добавить индексирование при работе с БД

## Тестирование

### Unit тесты
```bash
flutter test
```

Рекомендуемые тесты:
- Тесты моделей (Task, User)
- Тесты утилит (date_utils)
- Тесты логики (TaskProvider)

### Widget тесты
Тесты для проверки визуальной части:
- TaskCard
- WeekNavigation
- AddTaskDialog

### Integration тесты
Тесты для проверки полного потока:
- Добавление задачи
- Отметка выполнения
- Навигация между днями

## Развертывание

### iOS
```bash
flutter build ios --release
```

### Android
```bash
flutter build apk --release
```

### Web
```bash
flutter build web --release
```

## Зависимости

### Основные
- `flutter` - SDK Flutter
- `material` - Material Design компоненты

### Рекомендуемые для расширения
- `provider` - управление состоянием
- `sqflite` - локальная БД
- `firebase_core` - Firebase
- `intl` - интернационализация

## Лучшие практики

1. **Именование**
   - Классы: PascalCase (TaskCard)
   - Функции/переменные: camelCase (getGreeting)
   - Константы: UPPER_SNAKE_CASE

2. **Структурирование**
   - Один класс в одном файле
   - Логическая группировка по папкам
   - Четкая иерархия

3. **Комментарии**
   - Документировать сложную логику
   - Использовать /// для документации классов и методов

4. **Форматирование**
   ```bash
   flutter format .
   ```

5. **Анализ**
   ```bash
   flutter analyze
   ```

## Известные ограничения

1. Данные задач хранятся в памяти приложения
2. Нет персистентного хранилища на диске
3. Вкладка "Доска" не реализована
4. Нет уведомлений/напоминаний
5. Нет синхронизации между устройствами
